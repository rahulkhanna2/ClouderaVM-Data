use database_name;
show tables;
describe foramtted table_name;

create database retail_db_txt
set hive.metastore.warehouse.dir;

create table orders (order_id int, order_date string, order_customer_id int, order_status string) row format delimited fields terminated by ',' stored as textfile;

create table order_items (order_item_id int, order_item_order_id int,  order_item_product_id int, order_item_quantity int, order_item_subtotal float, order_item_product_price float) row format delimited fields terminated by ',' stored as textfile;

load data local inpath "/home/cloudera/Desktop/data/retail_db/orders" into table orders;

load data local inpath "/home/cloudera/Desktop/data/retail_db/order_items" into table order_items;

sqoop import \
	--connect jdbc:mysql://quickstart.cloudera/retail_db \
	--username root \
	--password cloudera \
	--table products \
	--hive-import \
	--hive-database retail_db_txt \
	--hive-table products \
	--num-mappers 2


create table ordersComplete as select order_date, order_item_product_id, order_item_subtotal from orders o join order_items oi on o.order_id  = oi.order_item_order_id where (o.order_status = "COMPLETE" or o.order_status = "CLOSED" );


create table order_complete_pname as select order_date, order_item_subtotal, product_name from ordersComplete oc join products p on p.product_id = order_item_product_id order by order_date asc, order_item_subtotal desc;

create table daily_revenue_per_pname as select order_date,product_name, sum(order_item_subtotal) order_item_subtotal from order_complete_pname group by order_date, product_name, order_date order by order_date asc, order_item_subtotal desc;

[cloudera@quickstart ~]$ hadoop fs -mkdir hive_data 

--Save to hdfs file
INSERT OVERWRITE DIRECTORY '/user/cloudera/hive_data' select * from daily_revenue_per_pname;

--Save data from hive to local
INSERT OVERWRITE LOCAL DIRECTORY '/home/cloudera/hive_data' select * from daily_revenue_per_pname;

--save data to mysql database
mysql> create table daily_revenue_per_product_name (order_date varchar2(100), product_name varchar2(500), order_item_subtotal double)

[cloudera@quickstart ~]$ sqoop export \
	--connect jdbc:mysql://quickstart.cloudera/retail_export \
	--username root \
	--password cloudera \
	--table daily_revenue_per_product_name \
	--export-dir /home/cloudera/hive_data/ \
	--input-fields-terminated-by '\001'

